<!DOCTYPE html>
<html>

<head>
  <title>Log Viewer</title>
  <style>
    .logs {
      height: 600px;
      width: 100%;
      overflow: auto;
      border: 1px solid black;
      padding: 5px;
      margin-bottom: 20px;
    }

    .log-title {
      font-weight: bold;
      margin-top: 20px;
    }

  </style>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
  <h1 class="text-3xl font-bold pl-4">Log Viewer</h1>
  <p class="text-xl pl-4">This page will automatically update as new logs are received.</p>
  <div id="log-wrapper" class="flex flex-wrap">

  </div>
  <script>
    // Create a new EventSource instance for connecting to the server
    var eventSource = new EventSource("/logs");

    // Create a color mapping to approximate the colorama colors in CSS
    var colorMapping = {
      'GENERAL': 'white',
      'PLAN': 'green',
      'MOVE': 'cyan',
      'REACT': 'gold',
      'ACT': 'blue',
      'MESSAGE': 'lightblue',
      'REFLECT': 'magenta',
      'MEMORY': 'red',
      'THOUGHT': 'gray',
      'ERROR': 'red',
      'ANNOUNCEMENT': 'lightmagenta'
    };

    function typeWriter(text, i, element) {
      // check if text isn't finished yet
      if (i < (text.length)) {
        // add next character to h1
        element.innerHTML = text.substring(0, i + 1) + '<span aria-hidden="true"></span>';

        // wait for a while and call this function again for next character
        setTimeout(function () {
          typeWriter(text, i + 1, element)
        }, 25);
      }
    }


    var logWrapper = document.getElementById('log-wrapper');

    // When a new message is received
    eventSource.onmessage = function (e) {
      // Extract agent name, color, title, and description
      var matches = e.data.match(/^\[(.*?)\] \[(.*?)\] \[(.*?)\] (.*)$/);
      if (!matches) return;  // if the format is incorrect, ignore this log

      var agentName = matches[1].trim();
      var color = matches[2].trim().split('.')[1];
      var title = matches[3].trim();
      var description = matches[4].trim();

      // Find or create the log container for this agent
      var logLineContainer = document.getElementById('logs-' + agentName);
      if (!logLineContainer) {
        var logContainer = document.createElement('div');
        logContainer.className = 'md:w-1/2 p-4';
        logWrapper.appendChild(logContainer);

        var logTitle = document.createElement('h2');
        logTitle.textContent = 'Logs for ' + agentName;
        logTitle.className = 'log-title';
        logContainer.appendChild(logTitle);

        logLineContainer = document.createElement('div');
        logLineContainer.id = 'logs-' + agentName;
        logLineContainer.className = 'logs';
        logContainer.appendChild(logLineContainer);
      }

      // Create a new div for the log line
      var logLine = document.createElement('div');
      logLine.className = 'typewriter';

      // Create a new span for the title and set its style
      var titleSpan = document.createElement('span');
      titleSpan.textContent = title;
      titleSpan.style.color = colorMapping[color];
      console.log(colorMapping[color], color)
      titleSpan.style.fontWeight = 'bold';

      // Add the title and description to the log line
      logLine.appendChild(titleSpan);
      var text = document.createElement('span')
      logLine.appendChild(text);
      typeWriter(" " + description, 0, text)
      // Add the log line to the logs div
      logLineContainer.appendChild(logLine);

      // Scroll to the bottom of the logs div
      logLineContainer.scrollTop = logLineContainer.scrollHeight;
    };
  </script>
</body>

</html>